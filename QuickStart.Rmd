---
title: "Using the SpatialBall package"
author: "Derek Corcoran"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
```


The `SpatialBall` package was developed to visualize and analyze basketball data from the NBA, we will start by presenting several of our visualization functions, and later we will present our analysis tools

# Visualization Tools

## Season visualization tools:

We have two functions to plot all the shots of a Season, `ShotSeasonGraph` and `PointShotSeasonGraph` the later is not going to be shown in this vignette 

### ShotSeasonGraph

This function make the classic shot charts developed by Kirk Goldsberry, the default shows an hexagon in each point of the court, the bigger the hexagons, the more frequent the shots are, and the smaller the hexagons the least frequent the shots are. Also the color scale, in this case, shows the points per shot.

```{r}
library(SpatialBall)
data("season2017")
ShotSeasonGraph(Seasondata = season2017)
```

for `ShotSeasonGraph` you have two options for the Type of graph, the default (Shown above) is Points per Shot, you can change that to *PCT* to see the shooting percentage:

```{r}
ShotSeasonGraph(Seasondata = season2017, type = "PCT")
```

another option for this function is the quantile threshold of which shots are plotted, the default is 0.4, that means that the 40% least common shots are not plotted, if we increase that number, less hexagons will be shown

```{r}
ShotSeasonGraph(Seasondata = season2017, type = "PCT", quant = 0.6)
```


## Team visualization tools:

Just as season visualization tools, you can choose to plot shot charts or shot every shot of the team, you have to add to these the team you want to plot the shot-chart of, for *Season2017* the code for the teams are `r unique(season2017$TEAM_NAME)`, since teams have changed names over time, for each season you should use the following code to check the names `unique(season2017$TEAM_NAME)`, changing season2017 for the season you want to plot.

We have 2 functions for the visualization of team shot charts `DefShotSeasonGraphTeam`and `OffShotSeasonGraphTeam`, both of them are similar to the `ShotSeasonGraph` function, but focus on one team, and let's you get the offensive or defensive shot chart for each team in either Point per shot (type = "PPS") or percentage (type = "PCT").

## DefShotSeasonGraphTeam:

These are examples of Charlotte's defensive Shot Charts as PPS and PCT

```{r}
DefShotSeasonGraphTeam(season2017, team = "Cha")
DefShotSeasonGraphTeam(season2017, team = "Cha", type = "PCT")
```

### OffShotSeasonGraphTeam

As an example for the Offensive shot charts we will shot for the 2017 season the shot charts for the Charlotte Hornets:
```{r}
OffShotSeasonGraphTeam(season2017, team = "Cha")
```

Again we can change the graph to Shooting percentage by changing type to *PCT*

```{r}
OffShotSeasonGraphTeam(season2017, team = "Cha", type = "PCT")
```

### PointShotSeasonGraphTeam

If instead of a Shot-chart based on hexagons, you want to plot every shot as a single point, you can do that with *PointShotSeasonGraphTeam*, this divides shots in made and misses, also each shot has a high transparency (Alpha of 0.2 in ggplot), in order for areas of low density shots having less colors than the areas with more shots.

```{r}
PointShotSeasonGraphTeam(season2017, "Cha")
```

## Comparative visualization tools:

The function to visually compare two teams it's called *ShotComparisonGraph*, and it uses our comparative shot charts, in this example we have Charlotte against Cleveland. In the top row we see the defensive shot chart of the cavaliers, the Offensive Shot Chart of the Hornets, and the net Shot Chart of the expected points per Shot when Hornets Faces the Cavaliers Defense. At points where the hexagons are blue, the defense is allowing fewer points than average and the offense is scoring fewer points than average, and the inverse is true for red hexagons. Conversely the bottom row shows the inverse.

```{r}
data("season2017")
ShotComparisonGraph(HomeTeam = "Cha", VisitorTeam = "Cle", Seasondata = season2017)
```

We can focus on the areas where the offensive team is favored by adding to the code the *focus = "plus"* command, as follows, which will change only the last column of the graph.

```{r}
data("season2017")
ShotComparisonGraph(HomeTeam = "Cha", VisitorTeam = "Cle", Seasondata = season2017, focus = "plus")
```

## Player visualization tools:

We can also get shot charts for each player, both as PCT and as PPS, in this case we will just show the PPS for four of Charlotte's last season players:

```{r}
data("season2017")
OffShotSeasonGraphPlayer(season2017, player = "Nicolas Batum")
OffShotSeasonGraphPlayer(season2017, player = "Marco Belinelli")
OffShotSeasonGraphPlayer(season2017, player = "Spencer Hawes")
OffShotSeasonGraphPlayer(season2017, player = "Kemba Walker")
```


#Analysis Tools:

##Spread calculation

The function *Get_Apps* will analyse the pairwise spatial components of the teams involved in the game proposed and using our algorithm based on Boosted Regression Trees will predict the spread of the game, as an example we will show the predicted spread for Charlotte playing against Boston at Home and on the road:

```{r, message=FALSE, warning=FALSE}
data("season2017")
Get_Apps(HomeTeam = "Cha", VisitorTeam = "Bos", Seasondata = season2017)
```

```{r, message=FALSE, warning=FALSE}
Get_Apps(HomeTeam = "Bos", VisitorTeam = "Cha", Seasondata = season2017)
```

##Ranking Analysis

Finally our function *SpatialRating* will calculate the offensive, defensive and net rating for every team, with the shots to the date during the season.

```{r, echo=FALSE, results='hide', cache=TRUE, message=FALSE, warning=FALSE}
data("season2017")
Test <- SpatialRating(Seasondata = season2017)
```

```{r, eval=FALSE}
SpatialRating(Seasondata = season2017)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::kable(Test)
```

##Other minor functions and programatic possibilities

The package also calculates the percentage of shots taken and made by category (Threes, twos, dunks, etc.). It can also recalculate the spread assuming a player is injured, or traded by another player.

